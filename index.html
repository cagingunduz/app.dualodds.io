<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DualOdds App â€” Live Arbitrage Feed</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Instrument+Serif:ital@0;1&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a; --white: #f5f5f0; --neon: #d4ff00;
    --neon-glow: 0 0 40px rgba(212,255,0,0.4);
    --gray: #1c1c1c; --gray-mid: #2e2e2e; --gray-text: #888;
    --green: #00cc66; --orange: #ff9500; --red: #ff4444;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--black); color: var(--white); font-family: 'Syne', sans-serif; min-height: 100vh; }
  ::-webkit-scrollbar { width: 3px; } ::-webkit-scrollbar-thumb { background: var(--neon); }

  /* â”€â”€ AUTH GATE â”€â”€ */
  #authGate {
    display: none; position: fixed; inset: 0; z-index: 200;
    background: var(--black); align-items: center; justify-content: center; flex-direction: column; gap: 2rem;
  }
  #authGate.show { display: flex; }
  .gate-logo { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; letter-spacing: 0.1em; }
  .gate-logo span { color: var(--neon); }
  .gate-card { background: var(--gray); border: 1px solid var(--gray-mid); padding: 3rem; width: 100%; max-width: 420px; }
  .gate-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; margin-bottom: 0.5rem; }
  .gate-sub { font-family: 'Instrument Serif', serif; font-style: italic; color: var(--gray-text); font-size: 0.9rem; margin-bottom: 2rem; }
  .gate-tabs { display: flex; margin-bottom: 2rem; border-bottom: 1px solid var(--gray-mid); }
  .gate-tab { font-family: 'DM Mono', monospace; font-size: 0.72rem; letter-spacing: 0.12em; text-transform: uppercase; padding: 0.75rem 1.5rem; cursor: pointer; color: var(--gray-text); border-bottom: 2px solid transparent; background: none; border-top: none; border-left: none; border-right: none; transition: color 0.2s, border-color 0.2s; }
  .gate-tab.active { color: var(--neon); border-bottom-color: var(--neon); }
  .form-group { margin-bottom: 1.25rem; }
  .form-label { display: block; font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--gray-text); margin-bottom: 0.5rem; }
  .form-input { width: 100%; background: var(--black); border: 1px solid var(--gray-mid); color: var(--white); padding: 0.85rem 1rem; font-family: 'Syne', sans-serif; font-size: 0.9rem; outline: none; transition: border-color 0.2s; }
  .form-input:focus { border-color: var(--neon); }
  .form-input::placeholder { color: var(--gray-text); }
  .btn-auth { width: 100%; background: var(--neon); color: var(--black); border: none; padding: 1rem; font-family: 'DM Mono', monospace; font-size: 0.82rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: box-shadow 0.2s; margin-top: 0.5rem; }
  .btn-auth:hover { box-shadow: var(--neon-glow); }
  .btn-auth:disabled { opacity: 0.5; cursor: not-allowed; }
  .auth-msg { font-family: 'DM Mono', monospace; font-size: 0.72rem; text-align: center; margin-top: 1rem; padding: 0.75rem; display: none; }
  .auth-msg.error { background: rgba(255,60,60,0.1); color: #ff6b6b; border: 1px solid rgba(255,60,60,0.2); }
  .auth-msg.success { background: rgba(212,255,0,0.08); color: var(--neon); border: 1px solid rgba(212,255,0,0.2); }
  .back-link { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--gray-text); text-decoration: none; letter-spacing: 0.1em; transition: color 0.2s; }
  .back-link:hover { color: var(--neon); }

  /* â”€â”€ APP LAYOUT â”€â”€ */
  #appShell { display: none; }
  #appShell.show { display: block; }

  /* â”€â”€ TOP BAR â”€â”€ */
  .topbar {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    background: rgba(10,10,10,0.95); backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(212,255,0,0.1);
    display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 2rem;
  }
  .topbar-logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 0.1em; }
  .topbar-logo span { color: var(--neon); }
  .topbar-right { display: flex; align-items: center; gap: 1.5rem; }
  .topbar-plan { font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase; padding: 0.3rem 0.75rem; border: 1px solid var(--neon); color: var(--neon); }
  .topbar-email { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--gray-text); }
  .topbar-signout { background: none; border: 1px solid var(--gray-mid); color: var(--gray-text); font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.12em; text-transform: uppercase; padding: 0.4rem 0.85rem; cursor: pointer; transition: all 0.2s; }
  .topbar-signout:hover { border-color: var(--neon); color: var(--neon); }
  .btn-tg { display: inline-flex; align-items: center; gap: 0.4rem; background: #229ED9; border: none; color: #fff; font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; padding: 0.4rem 0.85rem; cursor: pointer; transition: all 0.2s; text-decoration: none; white-space: nowrap; }
  .btn-tg:hover { background: #1a8bbf; }
  .btn-tg.locked { background: none; border: 1px solid var(--gray-mid); color: var(--gray-text); cursor: not-allowed; }
  .btn-tg.locked:hover { background: none; }
  .filter-btn.plan-locked { opacity: 0.35; cursor: not-allowed; }

  /* â”€â”€ MAIN CONTENT â”€â”€ */
  .app-content { padding: 6rem 2rem 2rem; max-width: 1400px; margin: 0 auto; }

  /* â”€â”€ STATS ROW â”€â”€ */
  .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem; }
  .stat-card { background: var(--gray); border: 1px solid var(--gray-mid); padding: 1.5rem; position: relative; overflow: hidden; }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--neon); }
  .stat-card-label { font-family: 'DM Mono', monospace; font-size: 0.62rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--gray-text); margin-bottom: 0.5rem; }
  .stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; color: var(--neon); letter-spacing: 0.05em; line-height: 1; }
  .stat-card-sub { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--gray-text); margin-top: 0.3rem; }

  /* â”€â”€ FILTERS â”€â”€ */
  .filters { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: center; }
  .filter-label { font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--gray-text); }
  .filter-btn { background: var(--gray); border: 1px solid var(--gray-mid); color: var(--gray-text); font-family: 'DM Mono', monospace; font-size: 0.68rem; letter-spacing: 0.1em; text-transform: uppercase; padding: 0.4rem 1rem; cursor: pointer; transition: all 0.2s; }
  .filter-btn.active, .filter-btn:hover { border-color: var(--neon); color: var(--neon); background: rgba(212,255,0,0.05); }

  /* â”€â”€ ARB FEED â”€â”€ */
  .feed-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
  .feed-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 0.05em; }
  .feed-live { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--neon); display: flex; align-items: center; gap: 0.4rem; }
  .feed-live::before { content: 'â—'; animation: pulse 1s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
  .feed-updated { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--gray-text); }

  .arb-grid { display: flex; flex-direction: column; gap: 2px; }

  /* â”€â”€ ARB CARD â”€â”€ */
  .arb-card {
    background: var(--gray); border: 1px solid var(--gray-mid);
    padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 1rem;
    transition: border-color 0.2s, transform 0.15s;
    position: relative; overflow: hidden;
  }
  .arb-card:hover { border-color: var(--neon); transform: translateX(-3px); }
  .arb-card::before { content: ''; position: absolute; left: 0; top: 0; width: 3px; height: 100%; background: var(--neon); opacity: 0; transition: opacity 0.2s; }
  .arb-card:hover::before { opacity: 1; }
  .arb-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; }
  .arb-profit-col { text-align: right; flex-shrink: 0; }
  .arb-match-name { font-weight: 700; font-size: 0.95rem; margin-bottom: 0.3rem; }
  .arb-meta { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
  .arb-sport-tag { font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; background: var(--gray-mid); padding: 0.2rem 0.5rem; color: var(--gray-text); }
  .arb-time { font-family: 'DM Mono', monospace; font-size: 0.6rem; color: var(--gray-text); }
  .arb-score { font-family: 'DM Mono', monospace; font-size: 0.7rem; margin-top: 0.4rem; color: var(--gray-text); }
  .arb-score.live { color: var(--neon); }
  .score-live-dot { animation: blink 1s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }
  .arb-col-label { font-family: 'DM Mono', monospace; font-size: 0.58rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--gray-text); margin-bottom: 0.3rem; }
  .arb-col-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.05em; line-height: 1; }
  .arb-col-value.profit { color: var(--neon); }
  .arb-col-value.high { color: var(--neon); }
  .arb-col-value.med { color: #88cc00; }
  .arb-col-sub { font-family: 'DM Mono', monospace; font-size: 0.6rem; color: var(--gray-text); margin-top: 0.2rem; }
  .arb-book-links { display: flex; gap: 0.5rem; flex-wrap: wrap; }
  .arb-book-link { display: inline-flex; align-items: center; gap: 0.4rem; background: var(--gray-mid); border: 1px solid transparent; font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 0.4rem 0.8rem; color: var(--white); text-decoration: none; transition: all 0.2s; }
  .arb-book-link:hover { border-color: var(--neon); color: var(--neon); }
  .book-odds { color: var(--neon); font-weight: 700; }
  .arb-bottom { display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
  .btn-calc { background: transparent; border: 1px solid var(--neon); color: var(--neon); font-family: 'DM Mono', monospace; font-size: 0.68rem; letter-spacing: 0.1em; text-transform: uppercase; padding: 0.5rem 1.2rem; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .btn-calc:hover { background: var(--neon); color: var(--black); }

  /* â”€â”€ LOCKED OVERLAY â”€â”€ */
  .locked-overlay {
    position: fixed; inset: 0; z-index: 50;
    background: rgba(10,10,10,0.92);
    backdrop-filter: blur(12px);
    display: none; align-items: center; justify-content: center;
  }
  .locked-overlay.show { display: flex; }
  .locked-card { background: var(--gray); border: 1px solid var(--neon); padding: 4rem 3rem; text-align: center; max-width: 520px; width: 90%; box-shadow: 0 0 80px rgba(212,255,0,0.1); }
  .locked-icon { font-size: 3rem; margin-bottom: 1.5rem; }
  .locked-title { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; letter-spacing: 0.05em; margin-bottom: 0.75rem; line-height: 1; }
  .locked-title span { color: var(--neon); }
  .locked-sub { font-family: 'Instrument Serif', serif; font-style: italic; color: var(--gray-text); font-size: 1rem; line-height: 1.7; margin-bottom: 2.5rem; }
  .locked-plans { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2.5rem; }
  .locked-plan { background: var(--black); border: 1px solid var(--gray-mid); padding: 1.25rem 1rem; text-align: center; transition: border-color 0.2s; }
  .locked-plan:hover { border-color: var(--neon); }
  .locked-plan.featured { border-color: var(--neon); background: rgba(212,255,0,0.03); }
  .locked-plan-name { font-family: 'DM Mono', monospace; font-size: 0.62rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--gray-text); margin-bottom: 0.5rem; }
  .locked-plan-price { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; color: var(--white); line-height: 1; }
  .locked-plan.featured .locked-plan-price { color: var(--neon); }
  .locked-plan-period { font-family: 'DM Mono', monospace; font-size: 0.58rem; color: var(--gray-text); }
  .btn-subscribe { display: block; background: var(--neon); color: var(--black); font-family: 'DM Mono', monospace; font-size: 0.85rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; padding: 1rem 2.5rem; text-decoration: none; margin: 0 auto 1rem; border: none; cursor: pointer; transition: box-shadow 0.2s; }
  .btn-subscribe:hover { box-shadow: var(--neon-glow); }
  .locked-note { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--gray-text); }

  /* â”€â”€ CALCULATOR MODAL â”€â”€ */
  .calc-overlay { display: none; position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); align-items: center; justify-content: center; }
  .calc-overlay.open { display: flex; }
  .calc-modal { background: var(--gray); border: 1px solid var(--neon); padding: 2.5rem; width: 100%; max-width: 480px; position: relative; }
  .calc-close { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--gray-text); font-size: 1.2rem; cursor: pointer; }
  .calc-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; letter-spacing: 0.05em; margin-bottom: 0.3rem; }
  .calc-match { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--neon); letter-spacing: 0.1em; margin-bottom: 2rem; }
  .calc-row { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem; align-items: center; }
  .calc-row-header { font-family: 'DM Mono', monospace; font-size: 0.6rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--gray-text); }
  .calc-outcome { font-size: 0.85rem; font-weight: 600; }
  .calc-odds { font-family: 'DM Mono', monospace; font-size: 0.85rem; color: var(--neon); }
  .calc-stake { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; color: var(--white); }
  .calc-divider { height: 1px; background: var(--gray-mid); margin: 1.5rem 0; }
  .calc-result { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
  .calc-result-label { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--gray-text); letter-spacing: 0.1em; text-transform: uppercase; }
  .calc-result-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--neon); }
  .calc-bankroll-wrap { margin-bottom: 1.5rem; }
  .calc-bankroll-input { width: 100%; background: var(--black); border: 1px solid var(--gray-mid); color: var(--white); padding: 0.75rem 1rem; font-family: 'DM Mono', monospace; font-size: 1rem; outline: none; transition: border-color 0.2s; }
  .calc-bankroll-input:focus { border-color: var(--neon); }

  /* â”€â”€ TOAST â”€â”€ */
  .toast { position: fixed; bottom: 2rem; right: 2rem; z-index: 300; background: var(--gray); border: 1px solid var(--neon); padding: 1rem 1.5rem; font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--white); transform: translateY(100px); opacity: 0; transition: transform 0.3s, opacity 0.3s; display: flex; align-items: center; gap: 0.75rem; }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast-icon { color: var(--neon); }

  /* â”€â”€ LOADING â”€â”€ */
  #loadingScreen { position: fixed; inset: 0; background: var(--black); display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 1.5rem; z-index: 300; }
  .loading-logo { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; letter-spacing: 0.1em; animation: flicker 1.5s infinite; }
  .loading-logo span { color: var(--neon); }
  @keyframes flicker { 0%,100%{opacity:1} 50%{opacity:0.5} }
  .loading-bar { width: 200px; height: 2px; background: var(--gray-mid); overflow: hidden; }
  .loading-bar-fill { height: 100%; background: var(--neon); animation: loadBar 1.5s ease infinite; }
  @keyframes loadBar { 0%{width:0;margin-left:0} 50%{width:100%;margin-left:0} 100%{width:0;margin-left:100%} }

  /* â”€â”€ MOBILE â”€â”€ */
  @media (max-width: 768px) {
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .arb-card { padding: 1.25rem; }
    .arb-top { flex-direction: column; }
    .arb-profit-col { text-align: left; }
    .arb-bottom { flex-direction: column; align-items: flex-start; }
    .topbar-email { display: none; }
    .locked-plans { grid-template-columns: 1fr; }
    .app-content { padding: 5rem 1rem 1rem; }
    .calc-row { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingScreen">
  <div class="loading-logo">DUAL<span>ODDS</span></div>
  <div class="loading-bar"><div class="loading-bar-fill"></div></div>
</div>

<!-- AUTH GATE -->
<div id="authGate">
  <div class="loading-logo gate-logo">DUAL<span>ODDS</span></div>
  <div class="gate-card">
    <div class="gate-title">Welcome Back</div>
    <div class="gate-sub">Sign in to access your arbitrage feed</div>
    <div class="gate-tabs">
      <button class="gate-tab active" onclick="switchGateTab('login')">Sign In</button>
      <button class="gate-tab" onclick="switchGateTab('signup')">Create Account</button>
    </div>
    <div id="gateLoginForm">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="gateEmail" placeholder="you@example.com" />
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="form-input" type="password" id="gatePassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </div>
      <button class="btn-auth" id="gateLoginBtn" onclick="handleGateLogin()">Sign In â†’</button>
      <div id="gateLoginMsg" class="auth-msg"></div>
    </div>
    <div id="gateSignupForm" style="display:none">
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input class="form-input" type="text" id="gateSignupName" placeholder="John Smith" />
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="gateSignupEmail" placeholder="you@example.com" />
      </div>
      <div class="form-group">
        <label class="form-label">Password (min. 8 characters)</label>
        <input class="form-input" type="password" id="gateSignupPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </div>
      <button class="btn-auth" id="gateSignupBtn" onclick="handleGateSignup()">Create Account â†’</button>
      <div id="gateSignupMsg" class="auth-msg"></div>
    </div>
  </div>
  <a href="https://dualodds.io" class="back-link">â† Back to dualodds.io</a>
</div>

<!-- LOCKED OVERLAY (no subscription) -->
<div class="locked-overlay" id="lockedOverlay">
  <div class="locked-card">
    <div class="locked-icon">ğŸ”’</div>
    <div class="locked-title">UNLOCK YOUR<br><span>EDGE</span></div>
    <div class="locked-sub">You're logged in but don't have an active subscription. Choose a plan to access live arbitrage opportunities.</div>
    <div class="locked-plans">
      <div class="locked-plan">
        <div class="locked-plan-name">Basic</div>
        <div class="locked-plan-price">$29.99</div>
        <div class="locked-plan-period">/month</div>
      </div>
      <div class="locked-plan featured">
        <div class="locked-plan-name">Pro â˜…</div>
        <div class="locked-plan-price">$49.99</div>
        <div class="locked-plan-period">/month</div>
      </div>
      <div class="locked-plan">
        <div class="locked-plan-name">Elite</div>
        <div class="locked-plan-price">$79.99</div>
        <div class="locked-plan-period">/month</div>
      </div>
    </div>
    <button class="btn-subscribe" onclick="window.open('https://dualodds.io/#pricing','_blank')">View Plans & Subscribe â†’</button>
    <div class="locked-note">Already subscribed? <span style="color:var(--neon);cursor:pointer" onclick="checkManualPlan()">Click here to refresh</span></div>
  </div>
</div>

<!-- CALCULATOR MODAL -->
<div class="calc-overlay" id="calcModal">
  <div class="calc-modal">
    <button class="calc-close" onclick="closeCalc()">âœ•</button>
    <div class="calc-title">STAKE CALCULATOR</div>
    <div class="calc-match" id="calcMatchName">â€”</div>
    <div class="form-group calc-bankroll-wrap">
      <label class="form-label">Your Bankroll ($)</label>
      <input class="calc-bankroll-input" type="number" id="calcBankroll" value="1000" min="1" oninput="recalculate()" />
    </div>
    <div class="calc-row">
      <div class="calc-row-header">Outcome</div>
      <div class="calc-row-header">Odds</div>
      <div class="calc-row-header">Stake</div>
    </div>
    <div id="calcRows"></div>
    <div class="calc-divider"></div>
    <div class="calc-result">
      <div class="calc-result-label">Guaranteed Profit</div>
      <div class="calc-result-value" id="calcProfit">â€”</div>
    </div>
    <div class="calc-result">
      <div class="calc-result-label">Profit %</div>
      <div class="calc-result-value" id="calcPct" style="font-size:1.1rem">â€”</div>
    </div>
    <div class="calc-result">
      <div class="calc-result-label">Guaranteed Return</div>
      <div class="calc-result-value" id="calcReturn" style="font-size:1.1rem;color:var(--white)">â€”</div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span class="toast-icon">âœ“</span><span id="toastMsg"></span></div>

<!-- APP SHELL -->
<div id="appShell">
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="topbar-logo">DUAL<span>ODDS</span></div>
    <div class="topbar-right">
      <div class="topbar-plan" id="topbarPlan">FREE</div>
      <div class="topbar-email" id="topbarEmail">â€”</div>
      <a class="btn-tg locked" id="tgBtn" href="#" target="_blank" rel="noopener">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.16.16-.295.295-.605.295l.213-3.053 5.56-5.023c.242-.213-.054-.333-.373-.12L7.43 13.617l-2.963-.924c-.644-.204-.657-.644.136-.953l11.57-4.461c.537-.194 1.006.131.721.942z"/></svg>
        Alerts
      </a>
      <button class="topbar-signout" onclick="handleSignOut()">Sign Out</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="app-content">
    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-card-label">Live Opportunities</div>
        <div class="stat-card-value" id="statLive">24</div>
        <div class="stat-card-sub">Right now</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-label">Avg Profit</div>
        <div class="stat-card-value" id="statAvg">3.8%</div>
        <div class="stat-card-sub">Per opportunity</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-label">Bookmakers</div>
        <div class="stat-card-value">58</div>
        <div class="stat-card-sub">Monitored 24/7</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-label">Last Updated</div>
        <div class="stat-card-value" id="statUpdated" style="font-size:1.2rem">â€”</div>
        <div class="stat-card-sub">Auto-refreshes every 5 min</div>
      </div>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <span class="filter-label">Sport:</span>
      <button class="filter-btn active" data-sport="all" onclick="filterSport('all', this)">All</button>
      <button class="filter-btn" data-sport="soccer" onclick="filterSport('soccer', this)">âš½ Football</button>
      <button class="filter-btn" data-sport="basketball" onclick="filterSport('basketball', this)">ğŸ€ Basketball</button>
      <button class="filter-btn" data-sport="tennis" onclick="filterSport('tennis', this)">ğŸ¾ Tennis</button>
      <button class="filter-btn" data-sport="nfl" onclick="filterSport('nfl', this)">ğŸˆ NFL</button>
      <button class="filter-btn" data-sport="hockey" onclick="filterSport('hockey', this)">ğŸ’ Hockey</button>
    </div>

    <!-- FEED -->
    <div class="feed-header">
      <div class="feed-title">LIVE ARB FEED</div>
      <div style="display:flex;gap:1.5rem;align-items:center">
        <div class="feed-live">Scanning</div>
        <div class="feed-updated" id="feedUpdated">Updated just now</div>
      </div>
    </div>
    <div class="arb-grid" id="arbFeed"></div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SUPABASE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const { createClient } = supabase;
const sb = createClient(
  'https://tcsqwsunhddbmglqmmgq.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjc3F3c3VuaGRkYm1nbHFtbWdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NjA1NTQsImV4cCI6MjA4NzAzNjU1NH0.sNckIQ3yOrDhvCV0bzegIWwc3go96ZZcY9JPjWaIn_o'
);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ODDS API + TELEGRAM CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ODDS_API_KEY = '687f8318285c3daefff18acffe294923';
const TG_TOKEN = '8414884652:AAEPqw5D4-NLbkrsnNFitI3T2JsRCEC1WZM';
const TG_CHANNEL = '@dualodds1';
const TG_CHANNEL_LINK = 'https://t.me/dualodds1';

// All sports â€” each has a plans array saying which plans can access it
const ALL_SPORTS = [
  { key: 'soccer_epl',                label: 'âš½ Premier League', filter: 'soccer',     plans: ['basic','pro','elite'] },
  { key: 'soccer_spain_la_liga',      label: 'âš½ La Liga',        filter: 'soccer',     plans: ['basic','pro','elite'] },
  { key: 'soccer_germany_bundesliga', label: 'âš½ Bundesliga',     filter: 'soccer',     plans: ['basic','pro','elite'] },
  { key: 'basketball_nba',            label: 'ğŸ€ NBA',            filter: 'basketball', plans: ['basic','pro','elite'] },
  { key: 'tennis_atp_french_open',    label: 'ğŸ¾ Tennis',         filter: 'tennis',     plans: ['pro','elite'] },
  { key: 'americanfootball_nfl',      label: 'ğŸˆ NFL',            filter: 'nfl',        plans: ['elite'] },
  { key: 'icehockey_nhl',             label: 'ğŸ’ NHL',            filter: 'hockey',     plans: ['elite'] },
];

// Refresh rates per plan (ms)
const REFRESH_RATES = { basic: 10 * 60 * 1000, pro: 5 * 60 * 1000, elite: 1 * 60 * 1000 };

let SPORTS = ALL_SPORTS;
let refreshInterval = null;

let ARB_DATA = [];
let currentFilter = 'all';
let currentArb = null;
let userPlan = 'none';
let sentArbIds = new Set();

// Use match+date as key (stable across sessions, unlike eventId which can change)
function getMatchKey(arb) {
  const date = new Date(arb.commenceTime).toISOString().slice(0, 10); // YYYY-MM-DD
  return `${arb.match}_${date}`.toLowerCase().replace(/\s+/g, '_');
}

function loadSentIds() {
  try {
    const raw = localStorage.getItem('dualodds_sent');
    if (!raw) return;
    const { ids, savedAt } = JSON.parse(raw);
    // Expire after 24 hours
    if (Date.now() - savedAt < 24 * 60 * 60 * 1000) {
      ids.forEach(id => sentArbIds.add(id));
    } else {
      localStorage.removeItem('dualodds_sent'); // clear stale data
    }
  } catch(e) { localStorage.removeItem('dualodds_sent'); }
}

function saveSentIds() {
  try {
    localStorage.setItem('dualodds_sent', JSON.stringify({
      ids: [...sentArbIds],
      savedAt: Date.now()
    }));
  } catch(e) {}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FETCH & CALCULATE ARBITRAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchArbitrageOpportunities() {
  document.getElementById('feedUpdated').textContent = 'Scanning...';
  const allArbs = [];
  let id = 1;

  for (const sport of SPORTS) {
    try {
      const res = await fetch(
        `https://api.the-odds-api.com/v4/sports/${sport.key}/odds/?apiKey=${ODDS_API_KEY}&regions=uk,eu,us&markets=h2h&oddsFormat=decimal`
      );
      if (!res.ok) continue;
      const events = await res.json();

      for (const event of events) {
        const arb = findArbitrage(event, sport, id);
        if (arb) { allArbs.push(arb); id++; }
      }
    } catch (e) {
      console.log(`Skip ${sport.key}:`, e.message);
    }
  }

  // Sort by profit % descending
  allArbs.sort((a, b) => b.profitPct - a.profitPct);
  ARB_DATA = allArbs;

  // Send new arbs to Telegram
  if (allArbs.length > 0) sendNewArbAlerts(allArbs);

  const now = new Date();
  document.getElementById('statUpdated').textContent = now.toLocaleTimeString();
  document.getElementById('feedUpdated').textContent = `Updated ${now.toLocaleTimeString()}`;
  document.getElementById('statLive').textContent = allArbs.length;

  // Update avg profit
  if (allArbs.length > 0) {
    const avg = allArbs.reduce((s, a) => s + a.profitPct, 0) / allArbs.length;
    document.getElementById('statAvg').textContent = `+${avg.toFixed(1)}%`;
  }

  if (allArbs.length === 0) {
    document.getElementById('arbFeed').innerHTML = `
      <div style="text-align:center;padding:4rem;color:var(--gray-text);font-family:'DM Mono',monospace;font-size:0.8rem;">
        No arbitrage opportunities found right now. Markets are efficient at this moment.<br>
        <span style="color:var(--neon)">Auto-refreshing every 5 minutes...</span>
      </div>`;
  } else {
    renderFeed(ARB_DATA);
  }
}

function findArbitrage(event, sport, id) {
  // Banned bookmakers
  const BANNED = new Set(['BetMGM', 'Betfair', 'Betfair Exchange', 'Betfair Sportsbook', 'Suprabets', 'BetRivers', 'Smarkets', 'Casumo']);
  const bookmakers = event.bookmakers?.filter(bm => !BANNED.has(bm.title)) || [];
  const outcomeNames = new Set();
  bookmakers.forEach(bm => bm.markets?.[0]?.outcomes?.forEach(o => outcomeNames.add(o.name)));

  const bestOdds = {};
  outcomeNames.forEach(name => {
    let best = { odds: 0, book: '' };
    bookmakers.forEach(bm => {
      const outcome = bm.markets?.[0]?.outcomes?.find(o => o.name === name);
      if (outcome && outcome.price > best.odds) {
        best = { odds: outcome.price, book: bm.title };
      }
    });
    if (best.odds > 0) bestOdds[name] = best;
  });

  const outcomes = Object.entries(bestOdds).map(([name, {odds, book}]) => ({ name, odds, book }));
  if (outcomes.length < 2) return null;

  const impliedSum = outcomes.reduce((s, o) => s + (1 / o.odds), 0);
  if (impliedSum >= 1) return null; // Not an arbitrage

  const profitPct = ((1 / impliedSum) - 1) * 100;
  if (profitPct < 0.5) return null; // Too small

  const commence = new Date(event.commence_time);
  const timeStr = commence.toLocaleDateString() === new Date().toLocaleDateString()
    ? `Today ${commence.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`
    : commence.toLocaleDateString([], {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'});

  const books = [...new Set(outcomes.map(o => o.book))];

  return {
    id,
    eventId: event.id,
    commenceTime: event.commence_time,
    sport: sport.filter,
    sportLabel: sport.label,
    match: `${event.home_team} vs ${event.away_team}`,
    time: timeStr,
    profitPct: parseFloat(profitPct.toFixed(2)),
    profitAmt: parseFloat((profitPct * 10).toFixed(2)),
    bookmakers: books,
    outcomes
  };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', async () => {
  const { data: { session } } = await sb.auth.getSession();
  document.getElementById('loadingScreen').style.display = 'none';

  if (!session) {
    document.getElementById('authGate').classList.add('show');
    return;
  }
  initApp(session.user);
});

sb.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN' && session) {
    document.getElementById('authGate').classList.remove('show');
    initApp(session.user);
  }
  if (event === 'SIGNED_OUT') {
    document.getElementById('appShell').classList.remove('show');
    document.getElementById('authGate').classList.add('show');
  }
});

function initApp(user) {
  document.getElementById('appShell').classList.add('show');
  document.getElementById('topbarEmail').textContent = user.email;

  // Load previously sent Telegram IDs so we don't resend on refresh
  loadSentIds();

  const plan = user.user_metadata?.plan || 'none';
  userPlan = plan;
  updatePlanUI(plan);

  // Filter sports based on plan
  SPORTS = ALL_SPORTS.filter(s => s.plans.includes(plan));
  if (SPORTS.length === 0) SPORTS = ALL_SPORTS.filter(s => s.plans.includes('basic'));

  // Lock sport filter buttons not available on this plan
  updateSportFilters(plan);

  // Update refresh label on stat card
  const rateLabels = { basic: 'Refreshes every 10 min', pro: 'Refreshes every 5 min', elite: 'Refreshes every 1 min' };
  document.querySelector('.stat-card:last-child .stat-card-sub').textContent = rateLabels[plan] || 'Refreshes every 10 min';

  // Fetch data
  fetchLiveScores();
  fetchArbitrageOpportunities();

  // Dynamic refresh rate per plan
  const rate = REFRESH_RATES[plan] || REFRESH_RATES.basic;
  if (refreshInterval) clearInterval(refreshInterval);
  refreshInterval = setInterval(() => fetchArbitrageOpportunities(), rate);
  setInterval(() => fetchLiveScores(), 30 * 1000);
}

function updatePlanUI(plan) {
  const planEl = document.getElementById('topbarPlan');
  const tgBtn = document.getElementById('tgBtn');

  if (plan === 'none' || !plan) {
    planEl.textContent = 'NO PLAN';
    planEl.style.borderColor = 'var(--gray-mid)';
    planEl.style.color = 'var(--gray-text)';
    document.getElementById('lockedOverlay').classList.add('show');
    // Lock Telegram
    tgBtn.classList.add('locked');
    tgBtn.href = '#';
    tgBtn.onclick = (e) => { e.preventDefault(); showToast('Upgrade to Pro to access Telegram alerts'); };
  } else if (plan === 'basic') {
    planEl.textContent = 'BASIC';
    planEl.style.borderColor = 'var(--neon)';
    planEl.style.color = 'var(--neon)';
    document.getElementById('lockedOverlay').classList.remove('show');
    // Lock Telegram for Basic
    tgBtn.classList.add('locked');
    tgBtn.href = '#';
    tgBtn.onclick = (e) => { e.preventDefault(); showToast('ğŸ“± Upgrade to Pro to join the Telegram alerts channel'); };
  } else {
    // Pro or Elite â€” full access
    planEl.textContent = plan.toUpperCase();
    planEl.style.borderColor = 'var(--neon)';
    planEl.style.color = 'var(--neon)';
    document.getElementById('lockedOverlay').classList.remove('show');
    // Unlock Telegram
    tgBtn.classList.remove('locked');
    tgBtn.href = TG_CHANNEL_LINK;
    tgBtn.onclick = null;
  }
}

function updateSportFilters(plan) {
  const sportPlans = {
    soccer: ['basic','pro','elite'],
    basketball: ['basic','pro','elite'],
    tennis: ['pro','elite'],
    nfl: ['elite'],
    hockey: ['elite'],
  };
  document.querySelectorAll('.filter-btn[data-sport]').forEach(btn => {
    const sport = btn.dataset.sport;
    if (sport === 'all') return;
    if (sportPlans[sport] && !sportPlans[sport].includes(plan)) {
      btn.classList.add('plan-locked');
      const needed = (sport === 'tennis') ? 'Pro' : 'Elite';
      btn.onclick = (e) => {
        e.preventDefault();
        showToast(`Upgrade to ${needed} to access ${btn.textContent.trim()}`);
      };
    }
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TELEGRAM ALERTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendTelegramAlert(arb) {
  const bookLines = arb.outcomes.map(o => {
    const url = BOOKMAKER_LINKS[o.book] || 'https://google.com/search?q=' + encodeURIComponent(o.book);
    return `ğŸ“— <a href="${url}">${o.book}</a> â†’ <b>${o.odds}</b>`;
  }).join('\n');

  const profitEmoji = arb.profitPct >= 4 ? 'ğŸ”¥' : arb.profitPct >= 2 ? 'âœ…' : 'ğŸ’¡';

  const text =
`${profitEmoji} <b>ARB ALERT â€” +${arb.profitPct.toFixed(2)}% Profit</b>

ğŸŸ <b>${arb.match}</b>
${arb.sportLabel} Â· ğŸ• ${arb.time}

${bookLines}

ğŸ’° <b>+$${arb.profitAmt.toFixed(2)}</b> per $1,000 staked
ğŸ”— <a href="https://app.dualodds.io">Open in DualOdds</a>`;

  try {
    await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TG_CHANNEL,
        text,
        parse_mode: 'HTML',
        disable_web_page_preview: true
      })
    });
  } catch(e) { console.log('Telegram error:', e.message); }
}

async function sendNewArbAlerts(arbs) {
  // Only pre-match arbs (match hasn't started yet)
  const preMatch = arbs.filter(a => {
    const score = liveScores[a.eventId];
    const isLive = score && score.live;
    const isCompleted = score && score.completed;
    const hasStarted = new Date(a.commenceTime) <= new Date();
    return !isLive && !isCompleted && !hasStarted;
  });

  // Find the single best arb we haven't sent before (keyed by match+date)
  const bestNew = preMatch.find(a => !sentArbIds.has(getMatchKey(a)));
  if (!bestNew) return;

  await sendTelegramAlert(bestNew);
  sentArbIds.add(getMatchKey(bestNew));
  saveSentIds();
}

function checkManualPlan() {
  // Refresh session to check if plan was updated
  sb.auth.refreshSession().then(({ data }) => {
    if (data?.session) {
      const plan = data.session.user.user_metadata?.plan || 'none';
      userPlan = plan;
      updatePlanUI(plan);
      if (plan !== 'none') showToast('Plan activated! Welcome to DualOdds âœ“');
    }
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BOOKMAKER LINKS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BOOKMAKER_LINKS = {
  'Bet365': 'https://www.bet365.com',
  'William Hill': 'https://www.williamhill.com',
  'Pinnacle': 'https://www.pinnacle.com',
  'Unibet (UK)': 'https://www.unibet.co.uk',
  'Unibet (FR)': 'https://www.unibet.fr',
  'Unibet (NL)': 'https://www.unibet.nl',
  'Unibet (SE)': 'https://www.unibet.se',
  'Bwin': 'https://www.bwin.com',
  '1xBet': 'https://www.1xbet.com',
  'Betway': 'https://www.betway.com',
  'DraftKings': 'https://www.draftkings.com',
  'FanDuel': 'https://www.fanduel.com',
  'BetMGM': 'https://www.betmgm.com',
  'Caesars': 'https://www.caesars.com/sportsbook-and-casino',
  'Ladbrokes': 'https://www.ladbrokes.com',
  'Coral': 'https://www.coral.co.uk',
  'Paddy Power': 'https://www.paddypower.com',
  'Sky Bet': 'https://www.skybet.com',
  '888sport': 'https://www.888sport.com',
  'Marathon Bet': 'https://www.marathonbet.com',
  'Betclic (FR)': 'https://www.betclic.fr',
  'Betsson': 'https://www.betsson.com',
  'Nordic Bet': 'https://www.nordicbet.com',
  'BoyleSports': 'https://www.boylesports.com',
  'Bet Victor': 'https://www.betvictor.com',
  'LeoVegas': 'https://www.leovegas.com',
  'Matchbook': 'https://www.matchbook.com',
  'Smarkets': 'https://smarkets.com',
  'Winamax (FR)': 'https://www.winamax.fr',
  'Winamax (DE)': 'https://www.winamax.de',
  'BetRivers': 'https://www.betrivers.com',
  'Coolbet': 'https://www.coolbet.com',
  'Fanatics': 'https://www.fanatics.com',
  'MyBookie.ag': 'https://www.mybookie.ag',
  'BetOnline.ag': 'https://www.betonline.ag',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LIVE SCORES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let liveScores = {};

async function fetchLiveScores() {
  for (const sport of SPORTS) {
    try {
      const res = await fetch(
        `https://api.the-odds-api.com/v4/sports/${sport.key}/scores/?apiKey=${ODDS_API_KEY}&daysFrom=1`
      );
      if (!res.ok) continue;
      const games = await res.json();
      games.forEach(g => {
        if (g.scores) {
          liveScores[g.id] = {
            home: g.scores.find(s => s.name === g.home_team)?.score || '0',
            away: g.scores.find(s => s.name === g.away_team)?.score || '0',
            completed: g.completed,
            live: !g.completed && new Date(g.commence_time) <= new Date()
          };
        }
      });
    } catch(e) { continue; }
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEED RENDERING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFeed(data) {
  const feed = document.getElementById('arbFeed');
  const filtered = currentFilter === 'all' ? data : data.filter(a => a.sport === currentFilter);
  document.getElementById('statLive').textContent = filtered.length;

  if (filtered.length === 0) {
    feed.innerHTML = `
      <div style="text-align:center;padding:4rem;color:var(--gray-text);font-family:'DM Mono',monospace;font-size:0.8rem;">
        No arbitrage opportunities found right now. Markets are efficient at this moment.<br>
        <span style="color:var(--neon)">Auto-refreshing every 5 minutes...</span>
      </div>`;
    return;
  }

  feed.innerHTML = filtered.map(arb => {
    const score = liveScores[arb.eventId];
    const scoreHtml = score
      ? `<div class="arb-score ${score.live ? 'live' : ''}">
           ${score.live ? '<span class="score-live-dot">â—</span> LIVE ' : score.completed ? 'âœ“ FT ' : ''}
           ${score.home} â€“ ${score.away}
         </div>`
      : '';

    const bookLinks = arb.outcomes.map(o => {
      const url = BOOKMAKER_LINKS[o.book] || '#';
      return `<a class="arb-book-link" href="${url}" target="_blank" rel="noopener">
        ${o.book} <span class="book-odds">${o.odds}</span> â†’
      </a>`;
    }).join('');

    return `
    <div class="arb-card" data-id="${arb.id}">
      <div class="arb-top">
        <div>
          <div class="arb-match-name">${arb.match}</div>
          <div class="arb-meta">
            <span class="arb-sport-tag">${arb.sportLabel}</span>
            <span class="arb-time">ğŸ• ${arb.time}</span>
          </div>
          ${scoreHtml}
        </div>
        <div class="arb-profit-col">
          <div class="arb-col-label">Profit</div>
          <div class="arb-col-value ${arb.profitPct >= 4 ? 'high' : 'med'}">+${arb.profitPct.toFixed(1)}%</div>
          <div class="arb-col-sub">+$${arb.profitAmt}/Â£1000</div>
        </div>
      </div>
      <div class="arb-book-links">${bookLinks}</div>
      <div class="arb-bottom">
        <div class="arb-col-sub">${arb.outcomes.map(o => `${o.name}: ${o.odds}`).join(' Â· ')}</div>
        <button class="btn-calc" onclick="openCalc(${arb.id})">Calculate Stakes â†’</button>
      </div>
    </div>`;
  }).join('');
}

function filterSport(sport, btn) {
  currentFilter = sport;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderFeed(ARB_DATA);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CALCULATOR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCalc(id) {
  currentArb = ARB_DATA.find(a => a.id === id);
  if (!currentArb) return;
  document.getElementById('calcMatchName').textContent = currentArb.match;
  document.getElementById('calcModal').classList.add('open');
  recalculate();
}
function closeCalc() { document.getElementById('calcModal').classList.remove('open'); }

function recalculate() {
  if (!currentArb) return;
  const bankroll = parseFloat(document.getElementById('calcBankroll').value) || 1000;
  const odds = currentArb.outcomes.map(o => o.odds);
  const impliedSum = odds.reduce((s, o) => s + (1/o), 0);
  const profitPct = ((1/impliedSum) - 1) * 100;
  const guaranteedReturn = bankroll / impliedSum;
  const profit = guaranteedReturn - bankroll;

  document.getElementById('calcProfit').textContent = `$${profit.toFixed(2)}`;
  document.getElementById('calcPct').textContent = `+${profitPct.toFixed(2)}%`;
  document.getElementById('calcReturn').textContent = `$${guaranteedReturn.toFixed(2)}`;

  document.getElementById('calcRows').innerHTML = currentArb.outcomes.map(o => {
    const stake = (bankroll / (o.odds * impliedSum)).toFixed(2);
    return `
      <div class="calc-row" style="margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:1px solid var(--gray-mid)">
        <div>
          <div class="calc-outcome">${o.name}</div>
          <div style="font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--gray-text)">${o.book}</div>
        </div>
        <div class="calc-odds">${o.odds}</div>
        <div class="calc-stake">$${stake}</div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AUTH GATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchGateTab(tab) {
  document.querySelectorAll('.gate-tab').forEach((t, i) => {
    t.classList.toggle('active', (tab==='login'&&i===0)||(tab==='signup'&&i===1));
  });
  document.getElementById('gateLoginForm').style.display = tab==='login' ? 'block' : 'none';
  document.getElementById('gateSignupForm').style.display = tab==='signup' ? 'block' : 'none';
}

async function handleGateLogin() {
  const email = document.getElementById('gateEmail').value.trim();
  const password = document.getElementById('gatePassword').value;
  const btn = document.getElementById('gateLoginBtn');
  const msg = document.getElementById('gateLoginMsg');
  if (!email || !password) return showMsg(msg, 'Please fill in all fields.', 'error');
  btn.disabled = true; btn.textContent = 'Signing in...';
  const { error } = await sb.auth.signInWithPassword({ email, password });
  btn.disabled = false; btn.textContent = 'Sign In â†’';
  if (error) showMsg(msg, error.message, 'error');
}

async function handleGateSignup() {
  const name = document.getElementById('gateSignupName').value.trim();
  const email = document.getElementById('gateSignupEmail').value.trim();
  const password = document.getElementById('gateSignupPassword').value;
  const btn = document.getElementById('gateSignupBtn');
  const msg = document.getElementById('gateSignupMsg');
  if (!name||!email||!password) return showMsg(msg,'Please fill in all fields.','error');
  if (password.length < 8) return showMsg(msg,'Password must be at least 8 characters.','error');
  btn.disabled = true; btn.textContent = 'Creating account...';
  const { error } = await sb.auth.signUp({ email, password, options: { data: { full_name: name } } });
  btn.disabled = false; btn.textContent = 'Create Account â†’';
  if (error) showMsg(msg, error.message, 'error');
  else showMsg(msg, 'âœ“ Check your email to verify your account!', 'success');
}

async function handleSignOut() {
  await sb.auth.signOut();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showMsg(el, text, type) {
  el.style.display = 'block';
  el.className = `auth-msg ${type}`;
  el.textContent = text;
}
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}
function animateStats() {
  document.querySelectorAll('.arb-card').forEach(card => {
    const profitEl = card.querySelector('.arb-col-value.high, .arb-col-value.med');
    if (!profitEl) return;
    const base = parseFloat(profitEl.textContent);
    const newVal = Math.max(0.5, base + (Math.random()-0.5)*0.3).toFixed(1);
    profitEl.textContent = `+${newVal}%`;
  });
}

// Close calc on outside click
document.getElementById('calcModal').addEventListener('click', e => {
  if (e.target === document.getElementById('calcModal')) closeCalc();
});
</script>
</body>
</html>
